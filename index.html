<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VoiceSafe ‚Äì Anti-Scam Voice Analyzer</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    /* tiny polish */
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.12); }
    .shadow-soft { box-shadow: 0 18px 60px rgba(0,0,0,.35); }
    .btn:disabled { opacity: .45; cursor: not-allowed; }
    .progressBar { height: 10px; border-radius: 9999px; overflow: hidden; background: rgba(255,255,255,.12); }
    .progressFill { height: 100%; width: 0%; background: rgba(245, 158, 11, .85); border-radius: 9999px; transition: width .35s ease; }

    /* chips */
    .chip { display: inline-flex; align-items: center; gap: .5rem; border-radius: 9999px; padding: .35rem .75rem; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.10); color: rgba(255,255,255,.92); }

    /* risk ring */
    .risk-ring { box-shadow: 0 0 0 2px rgba(245,158,11,.18), 0 0 60px rgba(245,158,11,.08); }
    .risk-border { border: 1px solid rgba(245,158,11,.28); }

    /* risk badge */
    .risk-badge[data-risk="LOW"]{ border-color: rgba(34,197,94,.35); }
    .risk-badge[data-risk="GUARDED"]{ border-color: rgba(59,130,246,.35); }
    .risk-badge[data-risk="ELEVATED"]{ border-color: rgba(245,158,11,.40); }
    .risk-badge[data-risk="HIGH"]{ border-color: rgba(249,115,22,.45); }
    .risk-badge[data-risk="CRITICAL"]{ border-color: rgba(239,68,68,.50); }
  </style>
</head>

<body class="min-h-screen safe-pb text-white" style="background: radial-gradient(1200px 600px at 20% 10%, rgba(245,158,11,.08), transparent 60%), radial-gradient(1000px 600px at 85% 30%, rgba(59,130,246,.10), transparent 55%), #0b1220;">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-10">

    <!-- Fixed language switch (visible on desktop + mobile) -->
    <div class="glass shadow-soft" style="position:fixed;top:12px;right:12px;z-index:99999;padding:8px;border-radius:14px;">
      <select id="langSwitch" class="chip rounded-xl px-3 py-2 text-xs font-semibold" style="background: transparent;">
        <option value="en">üá∫üá∏ English</option>
        <option value="sk">üá∏üá∞ Slovensky</option>
        <option value="cs">üá®üáø ƒåesky</option>
        <option value="de">üá©üá™ Deutsch</option>
        <option value="fr">üá´üá∑ Fran√ßais</option>
        <option value="es">üá™üá∏ Espa√±ol</option>
        <option value="it">üáÆüáπ Italiano</option>
        <option value="pl">üáµüá± Polski</option>
        <option value="pt">üáµüáπ Portugu√™s</option>
        <option value="tr">üáπüá∑ T√ºrk√ße</option>
        <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
        <option value="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
        <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
        <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
        <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
      </select>
    </div>

    <!-- Top strip -->
    <div class="flex items-center justify-between gap-3 mb-6">
      <div class="inline-flex items-center gap-2 chip px-3 py-1.5 rounded-full text-xs">
        <i class="fa-solid fa-shield-halved"></i>
        <span class="opacity-90">Early Access</span>
        <span class="opacity-40">‚Ä¢</span>
        <span class="opacity-80"><span id="waitlistCountBadge">0</span> people joined</span>
      </div>

      <div class="hidden sm:flex items-center gap-2 text-xs opacity-80">
        <span id="liveActivity"></span>
      </div>
    </div>

    <!-- Trust bar -->
    <div class="mt-5 grid grid-cols-1 lg:grid-cols-12 gap-3 items-center mb-6">
      <div class="lg:col-span-7 text-xs opacity-85 tracking-wide">
        <span class="opacity-70">Built for evaluation by</span>
        <span class="font-semibold opacity-95"> Banks ‚Ä¢ Fraud Operations ‚Ä¢ Compliance (KYC/AML) ‚Ä¢ Investigations</span>
        <span class="opacity-50"> ‚Ä¢ </span>
        <span class="opacity-80">Advisory signals, not identity verification.</span>
      </div>
      <div class="lg:col-span-5 flex flex-wrap gap-2 lg:justify-end">
        <span class="chip rounded-full px-3 py-1 text-[11px]"><i class="fa-solid fa-user-shield"></i> Privacy-first posture</span>
        <span class="chip rounded-full px-3 py-1 text-[11px]"><i class="fa-solid fa-clipboard-check"></i> Audit-friendly outputs</span>
        <span class="chip rounded-full px-3 py-1 text-[11px]"><i class="fa-solid fa-plug"></i> API-first integration</span>
      </div>
    </div>

    <!-- HERO -->
    <div class="glass shadow-soft rounded-3xl p-6 sm:p-8 risk-ring risk-border">
      <div class="flex flex-wrap items-center gap-2 mb-3">
        <span class="chip text-xs"><i class="fa-solid fa-bolt"></i> Seconds, not minutes</span>
        <span class="chip text-xs"><i class="fa-solid fa-lock"></i> Privacy-first by design</span>
        <span class="chip text-xs"><i class="fa-solid fa-globe"></i> Global scam protection</span>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
        <div class="lg:col-span-7">
          <h1 id="heroTitle" class="text-3xl sm:text-4xl font-extrabold leading-tight">
            VoiceSafe ‚Äî The Risk Intelligence Layer
          </h1>
          <p id="heroDesc" class="mt-4 text-base sm:text-lg text-white/80 leading-relaxed">
            Upload a voice message. Know in seconds if it‚Äôs trying to scam you ‚Äî <b>before you send money</b>.
            Get a clear report: scam score, AI voice probability, stress signals, and red flags.
          </p>

          <div class="mt-6 flex flex-wrap gap-3">
            <button id="ctaAnalyze" class="btn chip px-5 py-3 rounded-2xl font-semibold bg-amber-400/90 text-black hover:bg-amber-400 transition">
              <i class="fa-solid fa-wand-magic-sparkles"></i> Start Risk Assessment
            </button>
            <button id="ctaDemo" class="btn chip px-5 py-3 rounded-2xl font-semibold hover:bg-white/10 transition">
              <i class="fa-solid fa-play"></i> View Platform Demo
            </button>
            <button id="ctaHow" class="btn chip px-5 py-3 rounded-2xl font-semibold hover:bg-white/10 transition">
              <i class="fa-solid fa-circle-info"></i> Explore Methodology
            </button>
          </div>

          <div class="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="glass rounded-2xl p-4">
              <div class="text-xs opacity-70">Storage posture</div>
              <div class="mt-1 font-semibold">No permanent storage</div>
              <div class="mt-1 text-xs opacity-70">Designed for privacy</div>
            </div>
            <div class="glass rounded-2xl p-4">
              <div class="text-xs opacity-70">Output</div>
              <div class="mt-1 font-semibold">Clear risk signals</div>
              <div class="mt-1 text-xs opacity-70">Human-readable summary</div>
            </div>
            <div class="glass rounded-2xl p-4">
              <div class="text-xs opacity-70">Use case</div>
              <div class="mt-1 font-semibold">Before paying</div>
              <div class="mt-1 text-xs opacity-70">Verify with official channels</div>
            </div>
          </div>
        </div>

        <div class="lg:col-span-5 space-y-3">
          <div class="glass rounded-2xl p-4">
            <div class="flex items-center gap-2 text-sm font-semibold">
              <i class="fa-solid fa-user-plus"></i> Join Early Access
            </div>
            <div class="mt-1 text-xs opacity-75">
              Helps prioritize features and builds credibility with investors.
            </div>
          </div>

          <div class="glass rounded-2xl p-4">
            <div class="flex items-center gap-2 text-sm font-semibold">
              <i class="fa-solid fa-triangle-exclamation"></i> Safety note
            </div>
            <div class="mt-1 text-xs opacity-75">
              VoiceSafe provides advisory signals. If money is involved, always verify via an official number (bank, company website, known contact).
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Analyzer -->
    <section id="analyzer" class="mt-6 sm:mt-8 grid grid-cols-1 lg:grid-cols-12 gap-4 sm:gap-6 items-start">
      <div class="lg:col-span-5 glass rounded-3xl p-5 sm:p-6">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 id="analyzeSampleTitle" class="text-lg font-semibold">Analyze a sample</h2>
            <p id="analyzeSampleDesc" class="text-sm text-white/70 mt-1">Upload audio/video or record a short clip.</p>
          </div>
          <span id="demoChip" class="chip text-xs"><i class="fa-solid fa-bolt"></i> Demo</span>
        </div>

        <div class="mt-4 space-y-3">
          <label class="text-xs opacity-75">Upload file</label>
          <input id="fileInput" type="file" accept="audio/*,video/*"
            class="w-full chip rounded-2xl px-4 py-3 text-sm outline-none focus:ring focus:ring-amber-400/30" />

          <div class="flex gap-3">
            <button id="recordBtn" class="btn chip rounded-2xl px-4 py-3 text-sm font-semibold hover:bg-white/10 transition w-1/2">
              <i class="fa-solid fa-microphone"></i> Record
            </button>
            <button id="analyzeBtn" class="btn chip rounded-2xl px-4 py-3 text-sm font-semibold bg-amber-400/90 text-black hover:bg-amber-400 transition w-1/2">
              <i class="fa-solid fa-wand-magic-sparkles"></i> Analyze
            </button>
          </div>

          <div class="text-xs text-white/70 pt-1">
            <span class="opacity-90">Free 3 analyses</span> ‚Ä¢ No signup required ‚Ä¢ Privacy-first
            <div class="mt-2 space-y-1">
              <div><i class="fa-solid fa-lock opacity-80"></i> No permanent voice storage (prototype)</div>
              <div><i class="fa-solid fa-bolt opacity-80"></i> Instant risk assessment</div>
            </div>
          </div>

          <div class="text-xs opacity-60">EU GDPR-ready posture</div>
        </div>

        <div class="mt-6 divider pt-5">
          <h3 class="text-sm font-semibold">Case details (optional)</h3>
          <p class="muted text-xs mt-1">Saved cases can be searched & shared (if backend supports it).</p>

          <div class="mt-4 space-y-3">
            <input id="title" class="w-full chip rounded-2xl p-3 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Title (e.g. Telegram investor)" />
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <input id="platform" class="w-full chip rounded-2xl p-3 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Platform (Telegram)" />
              <input id="country" class="w-full chip rounded-2xl p-3 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Country (US)" />
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <input id="language" class="w-full chip rounded-2xl p-3 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Language (EN)" />
              <input id="tags" class="w-full chip rounded-2xl p-3 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Tags (comma separated)" />
            </div>
            <textarea id="notes" rows="3" class="w-full chip rounded-2xl p-3 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Notes (what happened)"></textarea>
          </div>

          <div class="mt-4 text-xs muted">Tip: Keep personal data out of notes.</div>

          <div class="mt-5 chip rounded-2xl p-4 text-xs muted">
            <div class="font-semibold text-white/90">Disclaimer</div>
            <div class="mt-1">Scores are prototypes and can be wrong. Always verify identity using official channels.</div>
          </div>
        </div>
      </div>

      <div class="lg:col-span-7 glass rounded-3xl p-5 sm:p-6 risk-ring risk-border">
        <div class="flex flex-wrap items-start justify-between gap-3">
          <div>
            <div class="text-xs opacity-70">AI RISK ASSESSMENT</div>
            <h2 id="resultsTitle" class="text-xl font-bold mt-1">Results</h2>
            <p id="resultsDesc" class="text-sm text-white/70 mt-1">Structured risk output for compliance & fraud teams.</p>
          </div>

          <div class="flex flex-wrap gap-2">
            <button id="copyJsonBtn" class="btn chip text-xs px-3 py-2 rounded-xl hover:bg-white/10 transition">
              <i class="fa-solid fa-copy"></i> Copy JSON
            </button>
            <button id="copyLinkBtn" class="btn chip text-xs px-3 py-2 rounded-xl hover:bg-white/10 transition">
              <i class="fa-solid fa-link"></i> Copy share link
            </button>
            <button id="shareBtn" class="btn chip text-xs px-3 py-2 rounded-xl hover:bg-white/10 transition">
              <i class="fa-solid fa-share-nodes"></i> Share
            </button>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div class="glass rounded-2xl p-4 risk-badge" data-risk="ELEVATED">
            <div class="text-xs opacity-70">Scam score</div>
            <div class="mt-2 text-2xl font-extrabold"><span id="scamScore">‚Äî</span>%</div>
            <div class="mt-2 progressBar"><div id="scamBar" class="progressFill"></div></div>
          </div>

          <div class="glass rounded-2xl p-4 risk-badge" data-risk="GUARDED">
            <div class="text-xs opacity-70">AI voice probability</div>
            <div class="mt-2 text-2xl font-extrabold"><span id="aiProb">‚Äî</span>%</div>
            <div class="mt-2 progressBar"><div id="aiBar" class="progressFill"></div></div>
          </div>

          <div class="glass rounded-2xl p-4 risk-badge" data-risk="HIGH">
            <div class="text-xs opacity-70">Stress level</div>
            <div class="mt-2 text-2xl font-extrabold"><span id="stressLevel">‚Äî</span>%</div>
            <div class="mt-2 progressBar"><div id="stressBar" class="progressFill"></div></div>
          </div>
        </div>

        <div class="mt-4 glass rounded-2xl p-4">
          <div class="font-semibold text-sm">What to do if risk is high</div>
          <ol class="mt-2 text-xs text-white/75 space-y-1 list-decimal list-inside">
            <li>Stop the conversation. Don‚Äôt send money.</li>
            <li>Verify via an official channel (website number / known contact).</li>
            <li>Save and share the report if needed.</li>
          </ol>
        </div>

        <div class="mt-4 glass rounded-2xl p-4">
          <div class="font-semibold text-sm">Summary</div>
          <div id="summaryText" class="mt-1 text-sm text-white/75">Upload or record a sample to see results.</div>
          <div id="badgesRow" class="mt-3 flex flex-wrap gap-2"></div>
        </div>

        <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div class="glass rounded-2xl p-4">
            <div class="font-semibold text-sm">Saved case</div>
            <div class="text-xs text-white/70 mt-1">Case ID</div>
            <div id="caseId" class="mt-1 text-sm font-mono text-white/90">‚Äî</div>
            <button id="copySavedLinkBtn" class="btn chip text-xs px-3 py-2 rounded-xl hover:bg-white/10 transition mt-3">
              <i class="fa-solid fa-link"></i> Copy share link
            </button>
            <div id="caseStatus" class="mt-2 text-xs text-white/70"></div>
          </div>

          <div class="glass rounded-2xl p-4">
            <div class="font-semibold text-sm">Search cases</div>
            <div class="mt-3 space-y-2">
              <div class="flex gap-2">
                <input id="searchQuery" class="w-full chip rounded-2xl px-3 py-2 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Search title / notes..." />
                <button id="searchBtn" class="btn chip text-xs px-3 py-2 rounded-xl bg-amber-400/90 text-black hover:bg-amber-400 transition">Search</button>
              </div>
              <div class="flex gap-2">
                <input id="searchTag" class="w-full chip rounded-2xl px-3 py-2 text-sm outline-none focus:ring focus:ring-amber-400/30" placeholder="Tag filter (optional)" />
                <button id="clearSearchBtn" class="btn chip text-xs px-3 py-2 rounded-xl hover:bg-white/10 transition">Clear</button>
              </div>
              <div id="searchResults" class="text-xs text-white/70 mt-2"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- How it works -->
    <div class="mt-6 glass rounded-3xl p-5 sm:p-6">
      <h3 id="howItWorksTitle" class="text-lg font-semibold">How it works</h3>
      <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3">
        <div class="glass rounded-2xl p-4">
          <div class="text-xs opacity-70">1) Input</div>
          <div class="mt-1 font-semibold">Upload or record</div>
          <div class="mt-1 text-xs opacity-70">Audio/video supported</div>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="text-xs opacity-70">2) Analysis</div>
          <div class="mt-1 font-semibold">Risk scoring</div>
          <div class="mt-1 text-xs opacity-70">Signals + probabilities</div>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="text-xs opacity-70">3) Action</div>
          <div class="mt-1 font-semibold">Verify</div>
          <div class="mt-1 text-xs opacity-70">Use official channels</div>
        </div>
      </div>

      <p class="mt-4 text-xs text-white/70">
        VoiceSafe is a prototype. Scores can be wrong ‚Äî treat the report as an early warning system. When money is involved, always verify the caller via trusted, official contact methods.
      </p>
    </div>

    <!-- Footer -->
    <div class="mt-8 text-center text-xs text-white/60">
      VoiceSafe ‚Ä¢ Early Access ‚Ä¢ Built for global anti-scam awareness ‚Ä¢ voicesafe.ai
      <div class="mt-2 flex justify-center gap-4">
        <a class="hover:text-white/80" href="privacy.html">Privacy</a>
        <a class="hover:text-white/80" href="terms.html">Terms</a>
        <a class="hover:text-white/80" href="security.html">Security</a>
        <a class="hover:text-white/80" href="contact.html">Contact</a>
      </div>
      <div class="mt-2 text-[10px] opacity-60" id="buildTag"></div>
    </div>
  </div>

  <!-- ===========================
       Existing app logic (analyze/upload/cases/share)
       (NECH√ÅVAM, len jazykov√Ω syst√©m opravujem ni≈æ≈°ie)
  ============================ -->
  <script>
    // ---------------------------
    // Config
    // ---------------------------
    const BACKEND_URL = "https://voicesafe-backend-1.onrender.com";
    const AI_URL = "https://voicesafe-ai.onrender.com/analyze";

    const waitlistCountBadge = document.getElementById("waitlistCountBadge");
    const liveActivity = document.getElementById("liveActivity");
    const buildTag = document.getElementById("buildTag");

    // build tag
    try {
      const now = new Date();
      buildTag.textContent = "VoiceSafe.ai ‚Ä¢ BUILD: " + now.toISOString().slice(0,10);
    } catch {}

    // mock live activity (optional)
    (function(){
      const cities = ["New York","Paris","Bratislava","London","Berlin","Madrid","Toronto","Sydney","Dubai","Singapore"];
      setInterval(() => {
        const c = cities[Math.floor(Math.random()*cities.length)];
        liveActivity.textContent = `üî• Someone from ${c} joined ${Math.floor(Math.random()*35)+3}s ago`;
      }, 6500);
    })();

    // ---------------------------
    // UI elements
    // ---------------------------
    const fileInput = document.getElementById("fileInput");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const recordBtn = document.getElementById("recordBtn");
    const demoBtn = document.getElementById("demoBtn");

    const scamScoreEl = document.getElementById("scamScore");
    const aiProbEl = document.getElementById("aiProb");
    const stressLevelEl = document.getElementById("stressLevel");

    const scamBar = document.getElementById("scamBar");
    const aiBar = document.getElementById("aiBar");
    const stressBar = document.getElementById("stressBar");

    const summaryText = document.getElementById("summaryText");
    const badgesRow = document.getElementById("badgesRow");

    const copyJsonBtn = document.getElementById("copyJsonBtn");
    const copyLinkBtn = document.getElementById("copyLinkBtn");
    const shareBtn = document.getElementById("shareBtn");

    const caseIdEl = document.getElementById("caseId");
    const copySavedLinkBtn = document.getElementById("copySavedLinkBtn");
    const caseStatus = document.getElementById("caseStatus");

    const searchQuery = document.getElementById("searchQuery");
    const searchTag = document.getElementById("searchTag");
    const searchBtn = document.getElementById("searchBtn");
    const clearSearchBtn = document.getElementById("clearSearchBtn");
    const searchResults = document.getElementById("searchResults");

    const titleEl = document.getElementById("title");
    const platformEl = document.getElementById("platform");
    const countryEl = document.getElementById("country");
    const languageEl = document.getElementById("language");
    const tagsEl = document.getElementById("tags");
    const notesEl = document.getElementById("notes");

    // ---------------------------
    // Helpers
    // ---------------------------
    function setProgress(el, bar, val) {
      const v = Math.max(0, Math.min(100, Number(val || 0)));
      el.textContent = String(Math.round(v));
      bar.style.width = v + "%";
    }

    function addBadge(text) {
      const span = document.createElement("span");
      span.className = "chip text-[11px]";
      span.textContent = text;
      badgesRow.appendChild(span);
    }

    function setResults(data) {
      const scam = data?.scam_score ?? 0;
      const ai = data?.ai_voice_probability ?? 0;
      const stress = data?.stress_level ?? 0;

      setProgress(scamScoreEl, scamBar, scam);
      setProgress(aiProbEl, aiBar, ai);
      setProgress(stressLevelEl, stressBar, stress);

      badgesRow.innerHTML = "";
      if (Array.isArray(data?.red_flags)) {
        data.red_flags.slice(0, 6).forEach(f => addBadge(f));
      }

      summaryText.textContent = data?.summary || "Analysis complete. Review signals and verify via official channels.";
    }

    // ---------------------------
    // Analyze
    // ---------------------------
    async function analyzeFile(blob) {
      if (!blob) return;
      analyzeBtn.disabled = true;
      analyzeBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Analyzing...`;

      try {
        const fd = new FormData();
        fd.append("file", blob, "sample");

        // optional metadata
        fd.append("title", titleEl.value || "");
        fd.append("platform", platformEl.value || "");
        fd.append("country", countryEl.value || "");
        fd.append("language", languageEl.value || "");
        fd.append("tags", tagsEl.value || "");
        fd.append("notes", notesEl.value || "");

        const res = await fetch(AI_URL, { method: "POST", body: fd });
        if (!res.ok) throw new Error("AI analyze failed: " + res.status);
        const data = await res.json();

        window.__LAST_RESULT__ = data;
        setResults(data);

        // case id (if backend returns)
        if (data?.case_id) {
          caseIdEl.textContent = data.case_id;
          caseStatus.textContent = "Case saved.";
        } else {
          caseIdEl.textContent = "‚Äî";
          caseStatus.textContent = "";
        }

      } catch (e) {
        console.error(e);
        summaryText.textContent = "Error analyzing sample. Please try again.";
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.innerHTML = `<i class="fa-solid fa-wand-magic-sparkles"></i> Analyze`;
      }
    }

    analyzeBtn?.addEventListener("click", async () => {
      const f = fileInput.files?.[0];
      if (!f) {
        summaryText.textContent = "Please select a file first.";
        return;
      }
      await analyzeFile(f);
    });

    // ---------------------------
    // Record (simple)
    // ---------------------------
    let mediaRecorder = null;
    let recordedChunks = [];

    recordBtn?.addEventListener("click", async () => {
      try {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          return;
        }
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recordedChunks = [];
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = (e) => { if (e.data.size) recordedChunks.push(e.data); };
        mediaRecorder.onstop = async () => {
          stream.getTracks().forEach(t => t.stop());
          const blob = new Blob(recordedChunks, { type: "audio/webm" });
          await analyzeFile(blob);
        };
        mediaRecorder.start();
        recordBtn.innerHTML = `<i class="fa-solid fa-stop"></i> Stop`;
      } catch (e) {
        console.error(e);
        summaryText.textContent = "Recording not available (permission denied or unsupported).";
      }
    });

    // reset record label after stop (best-effort)
    document.addEventListener("click", () => {
      if (mediaRecorder && mediaRecorder.state !== "recording") {
        // do nothing
      }
    });

    // ---------------------------
    // Demo / CTA scroll
    // ---------------------------
    document.getElementById("ctaAnalyze")?.addEventListener("click", () => {
      document.getElementById("analyzer")?.scrollIntoView({ behavior: "smooth" });
    });

    document.getElementById("ctaHow")?.addEventListener("click", () => {
      document.getElementById("howItWorksTitle")?.scrollIntoView({ behavior: "smooth" });
    });

    document.getElementById("ctaDemo")?.addEventListener("click", () => {
      document.getElementById("analyzer")?.scrollIntoView({ behavior: "smooth" });
    });

    // ---------------------------
    // Copy/share helpers
    // ---------------------------
    function copyText(text) {
      if (!text) return;
      navigator.clipboard?.writeText(text).catch(()=>{});
    }

    copyJsonBtn?.addEventListener("click", () => {
      copyText(JSON.stringify(window.__LAST_RESULT__ || {}, null, 2));
      summaryText.textContent = "JSON copied.";
    });

    function buildShareLink() {
      const cid = (window.__LAST_RESULT__ && window.__LAST_RESULT__.case_id) ? window.__LAST_RESULT__.case_id : "";
      if (!cid) return "";
      return `${location.origin}${location.pathname}?case=${encodeURIComponent(cid)}`;
    }

    copyLinkBtn?.addEventListener("click", () => {
      const link = buildShareLink();
      if (!link) { summaryText.textContent = "No share link yet (analyze to create a case)."; return; }
      copyText(link);
      summaryText.textContent = "Share link copied.";
    });

    copySavedLinkBtn?.addEventListener("click", () => {
      const link = buildShareLink();
      if (!link) { caseStatus.textContent = "No case link yet."; return; }
      copyText(link);
      caseStatus.textContent = "Link copied.";
    });

    shareBtn?.addEventListener("click", async () => {
      const link = buildShareLink();
      if (!link) { summaryText.textContent = "No share link yet (analyze to create a case)."; return; }
      try {
        if (navigator.share) {
          await navigator.share({ title: "VoiceSafe report", text: "VoiceSafe risk report", url: link });
        } else {
          copyText(link);
          summaryText.textContent = "Share not supported ‚Äî link copied.";
        }
      } catch (e) {
        console.warn(e);
      }
    });

    // ---------------------------
    // Search cases (if backend supports)
    // ---------------------------
    async function searchCases() {
      const q = searchQuery.value || "";
      const tag = searchTag.value || "";
      searchResults.textContent = "Searching...";
      try {
        const url = new URL(BACKEND_URL + "/cases");
        if (q) url.searchParams.set("q", q);
        if (tag) url.searchParams.set("tag", tag);
        const res = await fetch(url.toString());
        if (!res.ok) throw new Error("Search failed");
        const data = await res.json();
        if (!Array.isArray(data) || !data.length) {
          searchResults.textContent = "No results.";
          return;
        }
        searchResults.innerHTML = data.slice(0, 6).map(c =>
          `<div class="mt-2 glass rounded-2xl p-3">
            <div class="text-xs opacity-70">${c.case_id || ""}</div>
            <div class="text-sm font-semibold">${(c.title || "").replace(/</g,"&lt;")}</div>
          </div>`
        ).join("");
      } catch (e) {
        console.error(e);
        searchResults.textContent = "Search not available.";
      }
    }

    searchBtn?.addEventListener("click", searchCases);
    clearSearchBtn?.addEventListener("click", () => {
      searchQuery.value = "";
      searchTag.value = "";
      searchResults.textContent = "";
    });

    // ---------------------------
    // bootWiring hook (legacy)
    // ---------------------------
    function bootWiring() {
      // ensure record label resets after stop
      if (recordBtn) {
        const observer = new MutationObserver(() => {});
        observer.observe(recordBtn, { childList: true, subtree: true });
      }
      // waitlist badge can be updated from backend later
      if (waitlistCountBadge) waitlistCountBadge.textContent = "0";
    }

    // ===========================
    // LANGUAGE SYSTEM (robust)
    // ===========================
const SUPPORTED_LANGS = [
  { code: "en", label: "üá∫üá∏ English" },
  { code: "sk", label: "üá∏üá∞ Slovensky" },
  { code: "cs", label: "üá®üáø ƒåesky" },
  { code: "de", label: "üá©üá™ Deutsch" },
  { code: "fr", label: "üá´üá∑ Fran√ßais" },
  { code: "es", label: "üá™üá∏ Espa√±ol" },
  { code: "it", label: "üáÆüáπ Italiano" },
  { code: "pl", label: "üáµüá± Polski" },
  { code: "pt", label: "üáµüáπ Portugu√™s" },
  { code: "tr", label: "üáπüá∑ T√ºrk√ße" },
  { code: "ru", label: "üá∑üá∫ –†—É—Å—Å–∫–∏–π" },
  { code: "uk", label: "üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞" },
  { code: "ar", label: "üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" },
  { code: "hi", label: "üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä" },
  { code: "zh", label: "üá®üá≥ ‰∏≠Êñá" },
  { code: "ja", label: "üáØüáµ Êó•Êú¨Ë™û" },
  { code: "ko", label: "üá∞üá∑ ÌïúÍµ≠Ïñ¥" },
];

const LANG_STORAGE_KEY = "vs_lang";

const I18N = {
  en: {},
  sk: {
    heroTitle: `VoiceSafe ‚Äî Inteligentn√° ochrana pred hlasov√Ωmi podvodmi`,
    heroDesc: `Nahraj hlasov√∫ spr√°vu. Zist√≠≈° do p√°r sek√∫nd, ƒçi ide o podvod ‚Äî e≈°te predt√Ωm, ne≈æ po≈°le≈° peniaze. Dostane≈° jasn√Ω report: scam sk√≥re, pravdepodobnos≈• AI hlasu, stres sign√°ly a red flags.`,
    ctaAnalyze: "Spusti≈• anal√Ωzu rizika",
    ctaDemo: "Pozrie≈• demo",
    ctaHow: "Ako to funguje",
    analyzeSampleTitle: "Analyzova≈• vzorku",
    analyzeSampleDesc: "Nahraj audio/video alebo nahraj kr√°tky z√°znam.",
    resultsTitle: "V√Ωsledky",
    resultsDesc: "≈†trukt√∫rovan√Ω v√Ωstup rizika pre compliance & fraud t√≠my.",
    recordBtn: "Nahr√°va≈•",
    analyzeBtn: "Analyzova≈•",
    demoBtn: "Demo",
    ph_title: "N√°zov (napr. Telegram investor)",
    ph_platform: "Platforma (Telegram)",
    ph_country: "Krajina (SK)",
    ph_language: "Jazyk (SK)",
    ph_tags: "Tagy (oddelen√© ƒçiarkou)",
    ph_notes: "Pozn√°mky (ƒço sa stalo)",
    howItWorksTitle: "Ako to funguje",
  },
  es: { ctaAnalyze: "Iniciar evaluaci√≥n de riesgo", ctaDemo: "Ver demo", ctaHow: "C√≥mo funciona" },
  fr: { ctaAnalyze: "Lancer l‚Äô√©valuation du risque", ctaDemo: "Voir la d√©mo", ctaHow: "Comment √ßa marche" },
  de: { ctaAnalyze: "Risikoanalyse starten", ctaDemo: "Demo ansehen", ctaHow: "So funktioniert‚Äôs" },
  it: { ctaAnalyze: "Avvia valutazione del rischio", ctaDemo: "Vedi demo", ctaHow: "Come funziona" },
  pt: { ctaAnalyze: "Iniciar avalia√ß√£o de risco", ctaDemo: "Ver demonstra√ß√£o", ctaHow: "Como funciona" },
  pl: { ctaAnalyze: "Uruchom ocenƒô ryzyka", ctaDemo: "Zobacz demo", ctaHow: "Jak to dzia≈Ça" },
  cs: { ctaAnalyze: "Spustit anal√Ωzu rizika", ctaDemo: "Zobrazit demo", ctaHow: "Jak to funguje" },
  tr: { ctaAnalyze: "Risk analizi ba≈ülat", ctaDemo: "Demoyu g√∂r", ctaHow: "Nasƒ±l √ßalƒ±≈üƒ±r" },
  ru: { ctaAnalyze: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–∞", ctaDemo: "–°–º–æ—Ç—Ä–µ—Ç—å –¥–µ–º–æ", ctaHow: "–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç" },
  uk: { ctaAnalyze: "–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É —Ä–∏–∑–∏–∫—É", ctaDemo: "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–µ–º–æ", ctaHow: "–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î" },
  ar: { ctaAnalyze: "ÿ®ÿØÿ° ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖÿÆÿßÿ∑ÿ±", ctaDemo: "ÿπÿ±ÿ∂ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™Ÿàÿ∂Ÿäÿ≠Ÿä", ctaHow: "ŸÉŸäŸÅ ŸäÿπŸÖŸÑ" },
  hi: { ctaAnalyze: "‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç", ctaDemo: "‡§°‡•á‡§Æ‡•ã ‡§¶‡•á‡§ñ‡•á‡§Ç", ctaHow: "‡§Ø‡§π ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à" },
  zh: { ctaAnalyze: "ÂºÄÂßãÈ£éÈô©ËØÑ‰º∞", ctaDemo: "Êü•ÁúãÊºîÁ§∫", ctaHow: "Â∑•‰ΩúÂéüÁêÜ" },
  ja: { ctaAnalyze: "„É™„Çπ„ÇØË©ï‰æ°„ÇíÈñãÂßã", ctaDemo: "„Éá„É¢„ÇíË¶ã„Çã", ctaHow: "‰ªïÁµÑ„Åø" },
  ko: { ctaAnalyze: "ÏúÑÌóò ÌèâÍ∞Ä ÏãúÏûë", ctaDemo: "Îç∞Î™® Î≥¥Í∏∞", ctaHow: "ÏûëÎèô Î∞©Ïãù" },
};

function normalizeLang(lang) {
  if (!lang) return "en";
  const base = String(lang).toLowerCase().split("-")[0];
  const supported = SUPPORTED_LANGS.some(l => l.code === base);
  return supported ? base : "en";
}

function detectLang() {
  const saved = localStorage.getItem(LANG_STORAGE_KEY);
  if (saved) return normalizeLang(saved);
  const nav = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.language;
  return normalizeLang(nav);
}

function t(key, lang) {
  const l = lang || "en";
  return (I18N[l] && I18N[l][key]) || (I18N.en && I18N.en[key]) || "";
}

function setText(id, key, lang) {
  const el = document.getElementById(id);
  if (!el) return;
  const val = t(key, lang);
  if (!val) return;
  el.textContent = val;
}

function setPlaceholder(id, key, lang) {
  const el = document.getElementById(id);
  if (!el) return;
  const val = t(key, lang);
  if (!val) return;
  el.setAttribute("placeholder", val);
}

function setButtonLabel(buttonId, key, lang) {
  const btn = document.getElementById(buttonId);
  if (!btn) return;
  const val = t(key, lang);
  if (!val) return;
  const icon = btn.querySelector("i");
  if (icon) btn.innerHTML = icon.outerHTML + " " + val;
  else btn.textContent = val;
}

function applyTranslations(lang) {
  setText("heroTitle", "heroTitle", lang);
  setText("heroDesc", "heroDesc", lang);

  setButtonLabel("ctaAnalyze", "ctaAnalyze", lang);
  setButtonLabel("ctaDemo", "ctaDemo", lang);
  setButtonLabel("ctaHow", "ctaHow", lang);

  setText("analyzeSampleTitle", "analyzeSampleTitle", lang);
  setText("analyzeSampleDesc", "analyzeSampleDesc", lang);
  setText("resultsTitle", "resultsTitle", lang);
  setText("resultsDesc", "resultsDesc", lang);

  setButtonLabel("recordBtn", "recordBtn", lang);
  setButtonLabel("analyzeBtn", "analyzeBtn", lang);
  setButtonLabel("demoBtn", "demoBtn", lang);

  setPlaceholder("title", "ph_title", lang);
  setPlaceholder("platform", "ph_platform", lang);
  setPlaceholder("country", "ph_country", lang);
  setPlaceholder("language", "ph_language", lang);
  setPlaceholder("tags", "ph_tags", lang);
  setPlaceholder("notes", "ph_notes", lang);

  setText("howItWorksTitle", "howItWorksTitle", lang);
}

function initLanguageSystem() {
  const langSwitch = document.getElementById("langSwitch");
  if (langSwitch && langSwitch.options && langSwitch.options.length < SUPPORTED_LANGS.length) {
    langSwitch.innerHTML = SUPPORTED_LANGS.map(l => `<option value="${l.code}">${l.label}</option>`).join("");
  }
  const initial = detectLang();
  if (langSwitch) langSwitch.value = initial;
  applyTranslations(initial);

  if (langSwitch) {
    langSwitch.addEventListener("change", (e) => {
      const next = normalizeLang(e.target.value);
      localStorage.setItem(LANG_STORAGE_KEY, next);
      applyTranslations(next);
    });
  }
}
  </script>

  <script src="share-card.js"></script>
  <script>
    // boot app (once)
    try { bootWiring(); } catch (e) { console.warn("bootWiring() not found yet", e); }
    try { initLanguageSystem(); } catch (e) { console.warn("Language init failed", e); }
  </script>

</body>
</html>